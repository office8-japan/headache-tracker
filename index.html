<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é ­ç—›è¨˜éŒ²ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-10 text-gray-800">

    <header class="bg-indigo-600 text-white p-4 shadow-lg mb-6 text-center">
        <div class="max-w-2xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">ğŸ¤• é ­ç—›è¨˜éŒ²ãƒãƒ¼ãƒˆ</h1>
            <span id="currentDate" class="text-sm opacity-90"></span>
        </div>
    </header>

    <main class="max-w-2xl mx-auto px-4 space-y-6">
        
        <section class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
            <h2 class="text-lg font-semibold mb-4 border-b pb-2">ä»Šã®çŠ¶æ³ã‚’è¨˜éŒ²</h2>
            <form id="headacheForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-2">ç—›ã¿ã®å¼·ã• (1-5)</label>
                    <input type="range" id="intensity" min="1" max="5" value="3" step="1" 
                           class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                    <div class="flex justify-between text-xs text-gray-500 mt-2 font-bold px-1">
                        <span class="text-blue-500">1:ã‹ã™ã‹ãªç—›ã¿</span>
                        <span class="text-yellow-600">3:æ™®é€š</span>
                        <span class="text-red-500">5:å‹•ã‘ãªã„</span>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mt-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">éƒ¨ä½</label>
                        <select id="location" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500 border p-2 bg-white">
                            <option value="ã“ã‚ã‹ã¿">ã“ã‚ã‹ã¿</option>
                            <option value="å¾Œé ­éƒ¨">å¾Œé ­éƒ¨</option>
                            <option value="é ­å…¨ä½“">é ­å…¨ä½“</option>
                            <option value="ç›®ã®å¥¥">ç›®ã®å¥¥</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">è–¬ã®æœç”¨</label>
                        <select id="medication" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500 border p-2 bg-white">
                            <option value="ãªã—">ãªã—</option>
                            <option value="ã‚ã‚Š">ã‚ã‚Š</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">ãƒ¡ãƒ¢</label>
                    <textarea id="memo" rows="2" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500 border p-2" placeholder="ç¡çœ ä¸è¶³ã€å¤©å€™ã€ã‚¹ãƒˆãƒ¬ã‚¹ãªã©..."></textarea>
                </div>

                <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl hover:bg-indigo-700 transition duration-200 active:scale-95 shadow-md">
                    è¨˜éŒ²ã‚’ä¿å­˜ã™ã‚‹
                </button>
            </form>
        </section>

        <section class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
            <h2 class="text-lg font-semibold mb-4 border-b pb-2">ç—›ã¿ã®æ¨ç§» (ç›´è¿‘7å›)</h2>
            <div class="h-48">
                <canvas id="headacheChart"></canvas>
            </div>
        </section>

        <section>
            <h2 class="text-lg font-semibold mb-3 text-gray-700">æœ€è¿‘ã®è¨˜éŒ²</h2>
            <div id="historyList" class="space-y-3">
                </div>
            
            <button id="clearData" class="mt-8 text-sm text-red-400 hover:text-red-600 hover:underline w-full text-center">
                ãƒ‡ãƒ¼ã‚¿ã‚’ã™ã¹ã¦æ¶ˆå»ã™ã‚‹
            </button>
        </section>

    </main>

    <script>
        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’è¡¨ç¤º
        document.getElementById('currentDate').innerText = new Date().toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' });

        // LocalStorageã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
        let records = JSON.parse(localStorage.getItem('headacheRecords')) || [];
        let myChart;

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®å‡¦ç†
        document.getElementById('headacheForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newRecord = {
                id: Date.now(),
                date: new Date().toLocaleString('ja-JP', {month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit'}),
                intensity: parseInt(document.getElementById('intensity').value),
                location: document.getElementById('location').value,
                medication: document.getElementById('medication').value,
                memo: document.getElementById('memo').value
            };

            // é…åˆ—ã®å…ˆé ­ã«è¿½åŠ 
            records.unshift(newRecord);
            // ä¿å­˜
            localStorage.setItem('headacheRecords', JSON.stringify(records));
            
            updateUI();
            e.target.reset(); // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
        });

        // UIï¼ˆä¸€è¦§ã¨ã‚°ãƒ©ãƒ•ï¼‰ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function updateUI() {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            
            if (records.length === 0) {
                list.innerHTML = '<p class="text-center text-gray-400 py-4">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
            }

            records.forEach(r => {
                const div = document.createElement('div');
                div.className = "bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex justify-between items-start";
                div.innerHTML = `
                    <div class="flex-1">
                        <div class="text-[10px] text-gray-400 font-bold uppercase">${r.date}</div>
                        <div class="font-bold text-gray-800 text-md mt-1">${r.location} / å¼·ã•: ${r.intensity}</div>
                        <div class="text-sm text-gray-500 mt-1">${r.memo || 'ãƒ¡ãƒ¢ãªã—'}</div>
                    </div>
                    <div class="ml-2">
                        <span class="px-2 py-1 rounded-full text-[10px] font-bold ${r.medication === 'ã‚ã‚Š' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-400'}">
                            è–¬:${r.medication}
                        </span>
                    </div>
                `;
                list.appendChild(div);
            });

            updateChart();
        }

        // ã‚°ãƒ©ãƒ•ã‚’æç”»ãƒ»æ›´æ–°ã™ã‚‹é–¢æ•°
        function updateChart() {
            const ctx = document.getElementById('headacheChart').getContext('2d');
            const displayData = [...records].reverse().slice(-7); // æœ€æ–°ã®7ä»¶ã‚’æ™‚ç³»åˆ—ã§è¡¨ç¤º

            if (myChart) myChart.destroy(); // æ—¢å­˜ã®ã‚°ãƒ©ãƒ•ãŒã‚ã‚Œã°å‰Šé™¤
            
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: displayData.map(r => r.date.split(' ')[0]), // æ—¥ä»˜ã®ã¿è¡¨ç¤º
                    datasets: [{
                        label: 'ç—›ã¿ã®å¼·ã•',
                        data: displayData.map(r => r.intensity),
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointBackgroundColor: '#4f46e5'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { 
                        y: { 
                            min: 0, 
                            max: 5, 
                            ticks: { stepSize: 1, font: { size: 10 } }
                        },
                        x: {
                            ticks: { font: { size: 10 } }
                        }
                    },
                    plugins: { 
                        legend: { display: false }
                    }
                }
            });
        }

            // å…¨æ¶ˆå»ãƒœã‚¿ãƒ³ã®å‡¦ç†
        document.getElementById('clearData').addEventListener('click', () => {
            if(confirm('ä»Šã¾ã§ã®è¨˜éŒ²ãŒã™ã¹ã¦æ¶ˆãˆã¾ã™ã€‚æœ¬å½“ã«ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem('headacheRecords');
                records = [];
                updateUI();
            }
        });

        // èµ·å‹•æ™‚ã«UIã‚’è¡¨ç¤º
        updateUI();
    </script>
</body>
</html>
